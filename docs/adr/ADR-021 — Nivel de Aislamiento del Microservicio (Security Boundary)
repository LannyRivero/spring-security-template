# ADR-021 â€” Nivel de Aislamiento del Microservicio (Security Boundary)
ğŸ“… Fecha: 2025-11-17  
ğŸ“ Estado: Aprobado

---

## ğŸ¯ Contexto

Spring Security Template es el **nÃºcleo comÃºn de seguridad** para ecosistemas de microservicios como:

- RenewSim  
- BuzÃ³n Inteligente  
- Otros mÃ³dulos externos  

Por tanto, su *boundary* (frontera de seguridad) debe estar claramente definido:

- QuÃ© expone  
- QuÃ© controla  
- QuÃ© delega  
- QuÃ© protege  

---

## ğŸ§  DecisiÃ³n

El microservicio opera bajo un **Security Boundary independiente**, con:

---

### 1ï¸âƒ£ AutenticaciÃ³n interna completa

El microservicio **genera** los tokens:

- firma RSA/HMAC  
- expiraciÃ³n  
- scopes  
- roles  

---

### 2ï¸âƒ£ El dominio de usuarios es local

`UserAccountGateway` puede:

- leer usuarios  
- validar credenciales  
- cargar roles/scopes  

---

### 3ï¸âƒ£ AutorizaciÃ³n descentralizada

Cada microservicio consumidor hace:

- ValidaciÃ³n de JWT  
- ComprobaciÃ³n de scopes  
- ComprobaciÃ³n de roles  

El sistema *no* implementa un Authorization Server tipo OAuth2.

---

### 4ï¸âƒ£ Boundaries explÃ­citos

| Capa | Responsable |
|------|-------------|
| Este mÃ³dulo | AutenticaciÃ³n, tokens, seguridad |
| Otros mÃ³dulos | AutorizaciÃ³n fina, permisos especÃ­ficos |

---

## âœ” Razones principales

### 1. Microservicios desacoplados  
Cada servicio evalÃºa permisos de manera local.

### 2. Reduce latencia  
No hay un â€œAuth Server centralizadoâ€ como cuello de botella.

### 3. Escalabilidad horizontal real  
Cada instancia valida tokens sin llamar a otros.

### 4. PreparaciÃ³n para OAuth2  
Boundary claro permite intercambiar TokenProvider por IdP externo.

---

## ğŸ§© Alternativas consideradas

### 1. Centralizar autorizaciÃ³n  
âœ— Demasiado acoplamiento  
âœ— Alto costo  
âœ— Un solo punto de fallo  

### 2. Hacerlo monolÃ­tico  
âœ— Rompe arquitectura limpia  

---

## ğŸ“Œ Consecuencias

### Positivas
- LÃ­mites claros  
- MÃ¡s simple de mantener  
- Cada mÃ³dulo es autÃ³nomo  
- Listo para escalar  

### Negativas
- Cada microservicio debe tener su propio `SecurityConfig`  

---

## ğŸ“¤ Resultado
