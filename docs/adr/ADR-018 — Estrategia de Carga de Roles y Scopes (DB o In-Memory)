# ADR-018 â€” Estrategia de Carga de Roles y Scopes (DB o In-Memory)
ğŸ“… Fecha: 2025-11-17  
ğŸ“ Estado: Aprobado

---

## ğŸ¯ Contexto

Roles y scopes determinan:

- QuÃ© puede hacer un usuario  
- QuÃ© recursos puede leer/escribir  
- QuÃ© acciones estÃ¡n permitidas  

El sistema debe ser:

- Simple en `dev`
- Validable en `test`
- Robusto en `prod`

---

## ğŸ§  DecisiÃ³n

Se define una estrategia dual:

---

### 1ï¸âƒ£ **Perfil dev â†’ InMemoryRoleProvider**
- Sin base de datos necesaria  
- Roles predefinidos (`ADMIN`, `USER`, `DEV`)  
- Scopes: `profile:read`, `*`  

Ventajas:
- RÃ¡pido  
- FÃ¡cil de probar  
- Ideal para demos, cursos, laptops  

---

### 2ï¸âƒ£ **Perfil prod â†’ DB o External Provider**
Roles y scopes se cargarÃ¡n desde:

- Tabla `roles`  
- Tabla `scopes`  
- Tabla `role_scopes`  

o fuentes externas:

- LDAP  
- Keycloak  
- Permission microservice  

Ventajas:
- Persistencia real  
- AdministraciÃ³n centralizada  
- AuditorÃ­a y control granular  

---

### 3ï¸âƒ£ Scope Policy  
Se mantiene desacoplada en una interfaz:

```java
interface ScopePolicy {
    boolean isAllowed(String scope, User user);
}
