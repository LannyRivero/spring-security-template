# ADR-020 â€” RotaciÃ³n de Claves RSA (Key Rotation Strategy)
ğŸ“… Fecha: 2025-11-17  
ğŸ“ Estado: Planificado

---

## ğŸ¯ Contexto

Los JWT dependen de la firma RSA/HMAC.  
En producciÃ³n, por normativa y buenas prÃ¡cticas, es obligatorio:

- Rotar claves  
- Evitar claves estÃ¡ticas  
- Mitigar impacto si una clave es comprometida  
- Actualizar claves sin downtime  
- Permitir validar tokens antiguos  

EstÃ¡ndares relevantes:

- OWASP ASVS  
- NIST SP 800-57  
- PCI-DSS  
- OAuth2 / OIDC  

---

## ğŸ§  DecisiÃ³n

Documentar e implementar una **estrategia de rotaciÃ³n**, aunque no se activa por defecto.

### Estrategia recomendada:

---

### 1ï¸âƒ£ Key Set (conjunto de claves)

Mantener:

- `kid` actual (active)  
- `kid` previous (validating)  

Tokens incluyen el header:

```json
{
  "kid": "rsa-key-2025"
}
---

### 2ï¸âƒ£ RotaciÃ³n sin downtime

- AÃ±adir nuevas claves en keystore
- Marcar como active
- Mover la antigua a previous
- Los tokens existentes siguen funcionando
- Expiran naturalmente
---

### 3ï¸âƒ£ Tiempo recomendado de rotaciÃ³n

- Cada 90 dÃ­as (estÃ¡ndar corporativo)

- Otras polÃ­ticas: 6 meses segÃºn industria
---

### 4ï¸âƒ£ ExpiraciÃ³n del previous key

DespuÃ©s de que todos los tokens firmados con la clave anterior expiren.

#### âœ” Razones principales
1. Cumple auditorÃ­as

Key Rotation es obligatorio en:

- bancos
- gobiernos
- salud

2. Seguridad real

Una clave comprometida no invalida todo el sistema.

3. Zero downtime

NingÃºn usuario pierde sesiÃ³n durante la rotaciÃ³n.
---
## ğŸ§© Alternativas consideradas
1. Clave Ãºnica estÃ¡tica

âœ— Vulnerabilidad grave
âœ— No cumple estÃ¡ndares

2. RotaciÃ³n â€œmanualâ€

âœ— Riesgo de invalidar tokens vÃ¡lidos
---
## ğŸ“Œ Consecuencias
- Positivas

  1. Seguridad incrementada
  2. Cumplimiento normativo
  3. Tokens vÃ¡lidos en mÃºltiples versiones

- Negativas

  1. Necesidad de gestionar mÃºltiples claves
  2. Complejidad en keystores
---
## ğŸ“¤ Resultado

El sistema queda preparado para implementar key rotation sin romper arquitectura ni requerir cambios en TokenProvider.