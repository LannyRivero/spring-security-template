ğŸ§± ADR-001 â€” Algoritmo de firma JWT: RSA vs HMAC

Estado: Aceptado
Fecha: 2025-03-01

ğŸ“Œ Contexto

El sistema requiere firmar y validar JWTs de forma segura. Las dos aproximaciones estÃ¡ndar son:

HMAC (HS256/384/512) â†’ clave simÃ©trica

RSA (RS256/384/512) â†’ clave asimÃ©trica

La plantilla debe funcionar:

En desarrollo (simples secretos HMAC o claves demo)

En producciÃ³n (claves seguras, rotaciÃ³n, integraciÃ³n con KMS/keystores)

En escenarios distribuidos (API Gateway, varios microservicios)

ğŸ† DecisiÃ³n

Usar RSA (asimÃ©trico) como algoritmo recomendado para entornos de producciÃ³n, y HMAC como opciÃ³n vÃ¡lida para dev/test.

ğŸ¯ Motivaciones tÃ©cnicas

âœ” RSA permite separar clave privada (servidor) y clave pÃºblica (consumidores).
âœ” Es mÃ¡s seguro para ecosistemas distribuidos.
âœ” Facilita la rotaciÃ³n de claves.
âœ” Compatible con Vault, AWS KMS, Azure KeyVault y keystores.
âœ” Cumple prÃ¡cticas recomendadas OWASP ASVS.

HMAC se mantiene por:

âœ” Simplicidad en dev/test
âœ” ConfiguraciÃ³n rÃ¡pida (una sola clave base64)
âœ” Menores dependencias

ğŸ”„ Alternativas consideradas

âŒ HMAC solo â†’ Inseguro en entornos distribuidos.
âŒ EC (Elliptic Curve) â†’ No necesario por ahora; se aÃ±ade en roadmap.
âŒ Claves embebidas â†’ Riesgo alto, descartado.

ğŸ“Œ Consecuencias

Los perfiles dev/test usan claves HMAC o RSA demo.

ProducciÃ³n exige keystore o secret manager.

El cÃ³digo debe ser agnÃ³stico al algoritmo (TokenProvider interfaz).
