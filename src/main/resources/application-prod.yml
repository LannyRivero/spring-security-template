# ================================================================
# üöÄ SPRING SECURITY TEMPLATE - PRODUCTION CONFIGURATION
# ================================================================

# =============================
# üóÑÔ∏è DATASOURCE (PostgreSQL)
# =============================
spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:spring_security_prod}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: validate
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    properties:
      hibernate:
        format_sql: true
    show-sql: false
  sql:
    init:
      mode: never

# =============================
# ‚öôÔ∏è SERVER CONFIG
# =============================
server:
  port: ${PORT:8080}
  forward-headers-strategy: framework
  error:
    include-message: never

# =============================
# üîê JWT CONFIGURATION (RSA)
# =============================
security:
  jwt:
    provider: nimbus          # o jjwt si usas el otro
    kid: prod-rsa-1
    issuer: security-template
    audience: security-template-app
    algorithm: RSA
    expiration-seconds: 3600
    service-expiration-seconds: 300
    allowed-clock-skew-seconds: 60

    # --- Option A: PEM (default RSA files) ---
    rsa:
      private-key-location: ${JWT_PRIVATE_PATH:file:/opt/keys/rsa-private.pem}
      public-key-location: ${JWT_PUBLIC_PATH:file:/opt/keys/rsa-public.pem}

    # --- Option B: Keystore (Enterprise) ---
    keystore:
      path: ${KEYSTORE_PATH:/opt/keys/security-template.p12}
      password: ${KEYSTORE_PASSWORD:changeit}
      key-alias: ${KEY_ALIAS:jwt-signing-key}
      key-password: ${KEY_PASSWORD:changeit}

# =============================
# üö¶ RATE LIMITING (Strict)
# =============================
rate-limiting:
  enabled: true
  strategy: IP_USER
  max-attempts: 3
  window: 60
  block-seconds: 600
  retry-after: 60
  login-path: /api/v1/auth/login

# =============================
# üåê CORS (Restricted)
# =============================
cors:
  enabled: true
  allow-credentials: true
  allowed-origins:
    - https://app.security-template.com
  allowed-methods: [ "GET", "POST", "PUT", "DELETE" ]
  allowed-headers:
    - Content-Type
    - Authorization
    - X-Requested-With
  exposed-headers:
    - Authorization
  max-age-seconds: 3600

# =============================
# üßæ LOGGING
# =============================
logging:
  level:
    root: WARN
    org.springframework.security: INFO
    org.hibernate.SQL: WARN
    com.lanny.spring_security_template: INFO

# =============================
# üìà ACTUATOR
# =============================
management:
  endpoints:
    web:
      exposure:
        include: health,info
data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      enabled: true
