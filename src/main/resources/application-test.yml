# ================================================================
# ðŸš€ SPRING SECURITY TEMPLATE - PRODUCTION CONFIGURATION
# ================================================================

spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST}:${DB_PORT:5432}/${DB_NAME}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    properties:
      hibernate:
        format_sql: false
    show-sql: false

  flyway:
    enabled: true
    validate-on-migrate: true
    clean-disabled: true
    locations: classpath:db/migration

  sql:
    init:
      mode: never

  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT:6379}
      timeout: 2s

# =============================
# SERVER CONFIG
# =============================
server:
  port: ${PORT:8080}
  forward-headers-strategy: framework
  error:
    include-message: never

# =============================
# OUTBOUND HTTP CLIENT
# =============================
http:
  client:
    connect-timeout: 2s
    request-timeout: 5s

# =============================
# JWT CONFIGURATION (RSA)
# =============================
security:
  jwt:
    issuer: security-template
    audience: security-template-app
    access-audience: access-service
    refresh-audience: refresh-service
    max-active-sessions: 1
    algorithm: RSA
    access-ttl: PT15M
    refresh-ttl: P7D
    rotate-refresh-tokens: true
    kid: prod-rsa-1

    rsa:
      private-key-location: ${JWT_PRIVATE_PATH:file:/opt/keys/rsa-private.pem}
      public-key-location: ${JWT_PUBLIC_PATH:file:/opt/keys/rsa-public.pem}

    keystore:
      path: ${KEYSTORE_PATH:/opt/keys/security-template.p12}
      password: ${KEYSTORE_PASSWORD}
      key-alias: ${KEY_ALIAS:jwt-signing-key}
      key-password: ${KEY_PASSWORD}

# =============================
# RATE LIMITING
# =============================
rate-limiting:
  enabled: true
  strategy: IP_USER
  max-attempts: 3
  window: 60
  block-seconds: 600
  retry-after: 60
  login-path: /api/v1/auth/login

# =============================
# CORS
# =============================
cors:
  enabled: true
  allow-credentials: false
  allowed-origins:
    - https://app.security-template.com
  allowed-methods: [ "GET", "POST", "PUT", "DELETE" ]
  allowed-headers:
    - Content-Type
    - Authorization
    - X-Requested-With
  exposed-headers:
    - Authorization
  max-age-seconds: 3600

# =============================
# LOGGING
# =============================
logging:
  level:
    root: WARN
    org.springframework.security: INFO
    org.hibernate.SQL: WARN
    com.lanny.spring_security_template: INFO

# =============================
# ACTUATOR
# =============================
management:
  endpoints:
    web:
      exposure:
        include: health,info


